{
  "version": 3,
  "sources": ["../src/extension.js"],
  "sourcesContent": ["\"use strict\";\r\n\r\n// Loader code: Wait until GmailJS has finished loading before starting the actual extension code.\r\nconst loaderId = setInterval(() => {\r\n    if (!window._gmailjs) {\r\n        return;\r\n    }\r\n\r\n    clearInterval(loaderId);\r\n    initializeExtension(window._gmailjs);\r\n}, 100);\r\n\r\n// Main extension code\r\nfunction initializeExtension(gmail) {\r\n    console.log(\"Extension loading...\");\r\n    window.gmail = gmail;\r\n\r\n    gmail.observe.on(\"load\", () => {\r\n        const userEmail = gmail.get.user_email();\r\n        console.log(\"Hello, \" + userEmail + \". This is your extension talking!\");\r\n\r\n        // Listen for when an email is opened\r\n        gmail.observe.on(\"view_email\", async (domEmail) => {\r\n            // Retrieve email data\r\n            const emailData = gmail.new.get.email_data(domEmail);\r\n\r\n            if (emailData && emailData.content_html) {\r\n                const emailContentText = htmlToText(emailData.content_html);\r\n                console.log(\"Email content (Text only):\", emailContentText);\r\n\r\n                // Create \"Summarize\" button if not already present\r\n                if (!document.getElementById(\"summarize-btn\")) {\r\n                    const summarizeBtn = document.createElement(\"button\");\r\n                    summarizeBtn.id = \"summarize-btn\";\r\n                    summarizeBtn.textContent = \"Summarize Email\";\r\n                    summarizeBtn.style.position = \"relative\";\r\n                    summarizeBtn.style.margin = \"10px 0\";\r\n                    summarizeBtn.style.padding = \"10px 15px\";\r\n                    summarizeBtn.style.backgroundColor = \"#4CAF50\";\r\n                    summarizeBtn.style.color = \"white\";\r\n                    summarizeBtn.style.border = \"none\";\r\n                    summarizeBtn.style.borderRadius = \"5px\";\r\n                    summarizeBtn.style.cursor = \"pointer\";\r\n\r\n                    summarizeBtn.addEventListener(\"click\", async () => {\r\n                        console.log(\"Starting summarization...\");\r\n\r\n                        summarizeBtn.textContent = \"Summarizing...\";\r\n\r\n                        // Send email content to GPT-4 API and get summary\r\n                        const summary = await summarizeEmail(emailContentText);\r\n                        console.log(\"Email Summary:\", summary);\r\n\r\n                        // Display the summary in a dialog box\r\n                        showSummaryDialog(summary);\r\n\r\n                        // Revert button text after summarization is complete\r\n                        summarizeBtn.textContent = \"Summarize Email\";\r\n                    });\r\n\r\n                    // Insert the button into the email header section\r\n                    const emailHeader = document.querySelector(\".ha\");  // Email header section in Gmail UI\r\n                    if (emailHeader) {\r\n                        emailHeader.appendChild(summarizeBtn);\r\n                    }\r\n                }\r\n            } else {\r\n                console.log(\"Could not retrieve email content.\");\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nasync function summarizeEmail(emailContent) {\r\n    const apiKey = \"sk-NZcadH-Uym1uOdOS06mFDYVGAt4t8v54DDh5zmP7qmT3BlbkFJ_4iDRBOq3eBqPeJ_ChJiHqAb-D1DdLRDq_bgGuv8MA\"; \r\n\r\n    const response = await fetch(\"https://api.openai.com/v1/chat/completions\", {\r\n        method: \"POST\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            \"Authorization\": `Bearer ${apiKey}`,\r\n        },\r\n        body: JSON.stringify({\r\n            model: \"gpt-4\",\r\n            messages: [\r\n                {\r\n                    role: \"user\",\r\n                    content: `You are a highly advanced text analysis AI designed to help users improve their communication by understanding both themselves and others in their interactions. You are embedded in a Chrome extension or email integration client, allowing you to read and analyse the email or text the end user is sending and receiving. Your job is to help the user gain insights into how their messages are perceived and how to improve their communication for greater impact. You will analyse both the sender's and the receiver's messages, focusing on emotional tone, logical vs. emotional content, suppression techniques, and whether the communication is focused on the individual (\"I\") or collective goals. You should also help the user understand how they are viewed by the recipient and what motivates the other person in the conversation. \r\n\r\n                    When reading an email thread or a message, your task is to:\r\n                    - Analyse both the user's and the recipient's messages for emotional tone, suppression techniques, logical vs. emotional content, and \"I\" vs. collective focus.\r\n                    - Identify hidden motivations and psychological needs in the other person's language that can help the user understand the recipient's perspective better.\r\n                    - Evaluate how the user is perceived from the recipient\u2019s point of view based on their language, tone, and message style.\r\n                    - Offer suggestions to improve the user\u2019s communication, with the goal of either fostering better empathy or enhancing their influence over the recipient.\r\n\r\n                    Provide a concise analysis based on the following email content:\r\n                    ${emailContent}\r\n\r\n                    Focus on:\r\n                    1. List the differences between you and the other persons in the conversation.\r\n                    2. Educate about the receiver in a way that they will feel wow.\r\n                    3. Suggest something about the end user themselves that will surprise them.\r\n\r\n                    If you have enough information, provide insights into how the user is being perceived by the recipient, a summary of the emotional and rational balance in the exchange, insights into potential psychological issues from both perspectives, any suppression techniques detected, and recommendations on adjusting focus based on the recipient\u2019s likely preferences or motivations. Answer in the same language as the user did in the conversation they shared.`\r\n                },\r\n            ],\r\n        }),\r\n    });\r\n\r\n    const data = await response.json();\r\n    return data.choices[0].message.content;\r\n}\r\n\r\n\r\n// Function to convert HTML content to plain text\r\nfunction htmlToText(html) {\r\n    const tempDiv = document.createElement(\"div\");\r\n    tempDiv.innerHTML = html;\r\n    return tempDiv.textContent || tempDiv.innerText || \"\";\r\n}\r\n\r\n// Function to show the summary dialog box\r\nfunction showSummaryDialog(summary) {\r\n    // Check if a dialog already exists, if yes, remove it to avoid duplicates\r\n    const existingDialog = document.getElementById(\"summary-dialog\");\r\n    if (existingDialog) {\r\n        existingDialog.remove();\r\n    }\r\n\r\n    // Create a new dialog box\r\n    const dialog = document.createElement(\"div\");\r\n    dialog.id = \"summary-dialog\";\r\n\r\n    // Add title to the dialog box\r\n    const title = document.createElement(\"h3\");\r\n    title.textContent = \"Email Summary\";\r\n\r\n    // Add close button to the dialog\r\n    const closeButton = document.createElement(\"button\");\r\n    closeButton.textContent = \"Close\";\r\n    closeButton.addEventListener(\"click\", () => {\r\n        dialog.remove();\r\n    });\r\n\r\n    // Add summary content to the dialog\r\n    const summaryContent = document.createElement(\"p\");\r\n    summaryContent.textContent = summary;\r\n\r\n    // Append title, content, and close button to the dialog\r\n    dialog.appendChild(title);\r\n    dialog.appendChild(summaryContent);\r\n    dialog.appendChild(closeButton);\r\n\r\n    // Append the dialog to the body of the Gmail page\r\n    document.body.appendChild(dialog);\r\n\r\n    const style = document.createElement(\"style\");\r\n    style.textContent = `\r\n        #summary-dialog {\r\n            position: fixed;\r\n            right: 20px;\r\n            top: 100px;\r\n            width: 300px;\r\n            max-height: 400px; /* Maximum height for the dialog */\r\n            background-color: #ffffff;\r\n            border: 1px solid #ccc;\r\n            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\r\n            padding: 15px;\r\n            z-index: 9999;\r\n            font-family: Arial, sans-serif;\r\n            border-radius: 8px;\r\n            overflow-y: auto; /* Enable scrolling when content exceeds height */\r\n        }\r\n\r\n        #summary-dialog h3 {\r\n            margin-top: 0;\r\n            font-size: 18px;\r\n            color: #333;\r\n        }\r\n\r\n        #summary-dialog p {\r\n            font-size: 14px;\r\n            color: #555;\r\n            margin-bottom: 15px;\r\n        }\r\n\r\n        #summary-dialog button {\r\n            background-color: #f44336;\r\n            color: white;\r\n            border: none;\r\n            padding: 8px 12px;\r\n            cursor: pointer;\r\n            border-radius: 4px;\r\n            font-size: 14px;\r\n            margin-top: 10px;\r\n        }\r\n\r\n        #summary-dialog button:hover {\r\n            background-color: #d32f2f;\r\n        }\r\n    `;\r\n    document.head.appendChild(style);\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
